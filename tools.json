{
  "ReservedCores": 2,
  "tools": {
    "avifenc": {
      "path": "",
      "category": "image",
      "enable_parallel": true,
      "priority": 1,
      "format": [".jpg", ".jpeg", ".png"],
      "template_parameters": {
        "QUALITY": 85
      },
      "parameters": [
        ["--speed", "6"],
        ["--jobs", "2"],
        ["-y", "444"],
        ["-q", "$QUALITY$"],
        ["$IN$", "$OUT$"]
      ]
    },
    "magick": {
      "path": "",
      "category": "image",
      "enable_parallel": false,
      "priority": 20,
      "format": [".jpg", ".jpeg", ".png", ".heic", ".heif"],
      "template_parameters": {
        "QUALITY": 78
      },
      "parameters": [
        ["-limit", "thread", "1"],
        ["-quality", "$QUALITY$"],
        ["-define", "heic:chroma=444"],
        ["$IN$", "avif:$OUT$"]
      ]
    },
    "nconvert": {
      "path": "",
      "category": "image",
      "enable_parallel": false,
      "priority": 9,
      "format": [".heic", ".heif"],
      "template_parameters": {
        "QUALITY": 82
      },
      "parameters": [
        ["-out", "avif"],
        ["-keep_icc"],
        ["-overwrite"],
        ["-q", "$QUALITY$"],
        ["-o", "$OUT$"],
        ["$IN$"]
      ]
    },
    "ffmpeg": {
      "path": "",
      "category": "video",
      "priority": 1,
      "format": [".mp4", ".mov", ".wmv", ".avi", ".mkv"],
      "modes": {
        "gpu": {
          "template_parameters": {
            "CQ": 21
          },
          "parameters": [
            ["-y"], ["-hide_banner"], ["-loglevel", "warning"], ["-stats"],
            ["-i", "$IN$"],
            ["-c:v", "hevc_nvenc"],
            ["-cq", "$CQ$"],
            ["-preset", "p4"],
            ["-c:a", "aac"],
            ["-movflags", "+faststart"],
            ["-pix_fmt", "yuv420p"],
            ["-f", "mp4"],
            ["$OUT$"]
          ]
        },
        "cpu": {
          "template_parameters": {
            "CRF": 23
          },
          "parameters": [
            ["-y"], ["-hide_banner"], ["-loglevel", "warning"], ["-stats"],
            ["-i", "$IN$"],
            ["-c:v", "libx265"],
            ["-x265-params", "log-level=error"],
            ["-crf", "$CRF$"],
            ["-preset", "medium"],
            ["-c:a", "aac"],
            ["-movflags", "+faststart"],
            ["-pix_fmt", "yuv420p"],
            ["-f", "mp4"],
            ["$OUT$"]
          ]
        }
      }
    }
  },
  "checker": [
    {
      "tool": "ffmpeg",
      "name": "vmaf_checker",
      "category": "video_quality",
      "format": [".mp4", ".mov", ".mkv", ".avi"],
      "metric_name":"VMAF",
      "result_regex": "VMAF score:\\s*([0-9.]+)",
      "grading": [
        { "min": 90, "grade": "A", "color": "Green" },
        { "min": 75, "grade": "B", "color": "Cyan" },
        { "min": 50, "grade": "C", "color": "Yellow" },
        { "min": 0,  "grade": "D", "color": "Red" }
      ],
      "parameters": [
        ["-hide_banner"],
        ["-loglevel", "info"],
        ["-ss", "$START_TIME$","-t","$DURATION$","-i", "$SRC$"],
        ["-ss", "$START_TIME$", "-t","$DURATION$","-i", "$DST$"],
        ["-lavfi", "libvmaf=model='path=bin/vmaf.json':n_subsample=$SUBSAMPLE$"],
        ["-f", "null", "-"]
      ]
    },

    {
      "tool": "magick",
      "name": "ssim_checker",
      "category": "image_quality",
      "format": [".jpg", ".jpeg", ".png", ".webp"],
      "metric_name":"SSIM",
      "result_regex": "SSIM[^0-9]*([0-9.]+)",
      "grading": [
        { "min": 0.98, "grade": "A", "color": "Green" },
        { "min": 0.90, "grade": "B", "color": "Yellow" },
        { "min": 0.00, "grade": "D", "color": "Red" }
      ],
      "parameters": [
        ["compare", "-metric", "SSIM", "$SRC$", "$DST$", "null:"]
      ]
    }
  ]
}